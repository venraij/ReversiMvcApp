"use strict";function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){i=!0,a=e},f:function(){try{c||null==n.return||n.return()}finally{if(i)throw a}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var FeedbackWidget=function(){function e(t){_classCallCheck(this,e),this._elementId=t}return _createClass(e,[{key:"elementId",get:function(){return this._elementId}},{key:"show",value:function(e,t){toggleFeedback(this.elementId,!0),$("#".concat(this.elementId,"-text")).text(e);var n=$("#".concat(this.elementId));n.alert(),"danger"===t?(n.removeClass("alert-success"),n.addClass("alert-danger")):(n.removeClass("alert-danger"),n.addClass("alert-success")),this.log({message:e,type:t})}},{key:"hide",value:function(){toggleFeedback(this.elementId,!1)}},{key:"log",value:function(e){var t=[],n=JSON.parse(localStorage.getItem("feedback_widget"));n&&(t=n),10===t.length&&t.splice(1,11),t.push(e),localStorage.setItem("feedback_widget",JSON.stringify(t))}},{key:"removeLog",value:function(){localStorage.removeItem("feedback_widget")}},{key:"history",value:function(){var e,t=JSON.parse(localStorage.getItem("feedback_widget")),n="",o=_createForOfIteratorHelper(t);try{for(o.s();!(e=o.n()).done;){var r=e.value;n+="".concat(r.type," - ").concat(r.message),t[-1]===r&&(n+=" \n")}}catch(e){o.e(e)}finally{o.f()}this.show(n)}}]),e}(),Game=function(e){var t={gameState:0,token:null,spel:null},n=function(){var e=window.location.search,n=new URLSearchParams(e),a=n.get("Guid");console.log("Speler Token:",a),t.token=a,Game.Model.init(),Game.Data.init("production"),Game.Template.init(),Game.API.init(),Game.Reversi.init(a),setInterval(o,2e3),r().then(function(){Game.Reversi.drawBord(a,t.spel.Bord),Game.Reversi.checkAfgelopen(a,t.spel)}),Game.Data.connection.start().catch(function(e){return console.error(e.toString())})},o=function(){Game.Model.getGameState(t.token).then(function(e){console.log("New Game State:",e),t.gameState=e})},r=function(){return new Promise(function(e,n){Game.Model.getGame(t.token).then(function(o){console.log("Game:",o),null===o.token?(n("Geen game gevonden"),window.location="/"):e(t.spel=o)})})};return{init:n,getCurrentGameState:o,getCurrentGame:r}}();Game.Reversi=function(){var e=function(e){t.token=e},t={token:null,cels:[]},n=function(e,n){var o,r=0,c=0,i=_createForOfIteratorHelper(n);try{for(i.s();!(o=i.n()).done;){var l,u=o.value,s=_createForOfIteratorHelper(u);try{for(s.s();!(l=s.n()).done;){var f=l.value,p=void 0;t.cels.length!==n.length*u.length&&(p={yValue:c,xValue:r,fiche:null},t.cels.push(p));var m=void 0;1===f?m={kleur:"wit"}:2===f&&(m={kleur:"zwart"});var d=t.cels.find(function(e){return e.yValue===c&&e.xValue===r}),g=d?d.fiche:null;g?(console.log("Replacing fiche at:","y".concat(c," x").concat(r)),console.log("Old fiche:",f.fiche),(1===f&&"zwart"===g.kleur||2===f&&"wit"===g.kleur)&&(d.fiche=m)):0!==f&&(console.log("Placing fiche at:","y".concat(c," x").concat(r)),d.fiche=m),r++,8===r&&(r=0)}}catch(e){s.e(e)}finally{s.f()}c++}}catch(e){i.e(e)}finally{i.f()}var h=$(".play-area");a(),h.empty(),h.append(Game.Template.parseTemplate("bord",{cells:t.cels}))},o=function(e,o){try{Game.Data.connection.invoke("Zet",parseInt(e),parseInt(o),t.token),Game.Data.connection.on("ZetDone",function(e,o,a){console.log("New Bord:",JSON.parse(a).Bord,o),"SUCCEEDED"===o&&(n(t.token,JSON.parse(a).Bord),r(t.token))})}catch(e){console.error(e)}},r=function(e){Game.Model.getAfgelopen(e).then(function(e){if("Niet afgelopen"!==e){console.log("Spel is afgelopen:",e);var t=$(".bord");t.empty();var n,o=0,r=0,a=_createForOfIteratorHelper(e.Bord);try{for(a.s();!(n=a.n()).done;){var c,i=n.value,l=_createForOfIteratorHelper(i);try{for(l.s();!(c=l.n()).done;){switch(c.value){case 1:o+=1;break;case 2:r+=1}}}catch(e){l.e(e)}finally{l.f()}}}catch(e){a.e(e)}finally{a.f()}var u,s;o>r?(u="wit",s=o):o===r?u="none":r>o&&(u="zwart",s=r);var f=document.createElement("ul");f.className="scores-list",t.append(f);var p=document.createElement("li");p.className="score",p.textContent="Wit: ".concat(o," punten"),f.append(p);var m=document.createElement("li");m.className="score",m.textContent="Zwart: ".concat(r," punten"),f.append(m);var d=document.createElement("li");d.className="winner-score",d.textContent="none"===u?"Gelijkspel!":"De winnaar is ".concat(u," met ").concat(s," punten!"),f.append(d);var g=document.createElement("li"),h=document.createElement("button");h.textContent="Exit Game",h.className="exit-button",h.onclick=function(){window.location="/"},g.append(h),f.append(g),Game.Model.updateScores(e)}})},a=function(){Game.API.getFact().then(function(e){console.log(e);var t=Game.Template.parseTemplate("fact",e.data);$(".play-area").prepend(t)})};return{init:e,doeZet:o,drawBord:n,checkAfgelopen:r}}(),Game.Data=function(e){var t={environment:"development"},n={mock:[{url:"api/Spel/Beurt",data:0},{url:"api/Spel"}],apiUrl:e},o=function(e){return"development"===t.environment?i(e):"production"===t.environment?fetch(e,{method:"GET"}).then(function(e){return e.json()}).catch(function(e){console.log(e)}):void 0},r=function(e,n,o){if("production"===t.environment)return fetch(e,{method:"PUT",headers:{"Content-Type":"application/json",spelToken:o},body:JSON.stringify(n)}).then(function(e){return e.json()}).catch(function(e){console.log(e)})},a=function(e,n,o){if("production"===t.environment)return fetch(e,{method:"PATCH",headers:{"Content-Type":"application/json",spelToken:o},body:JSON.stringify(n)}).then(function(e){return e.json()}).catch(function(e){console.log(e)})},c=(new signalR.HubConnectionBuilder).withUrl("https://localhost:5001/gameHub").configureLogging(signalR.LogLevel.Information).build(),i=function(e){var t=n.mock.find(function(t){return t.url===e});return new Promise(function(e,n){e(t)})};return{init:function(e){if(console.log(n.apiUrl),t.environment=e,"production"!==t.environment&&"development"!==t.environment)throw new Error("Environment not set in state or set incorrectly")},get:o,put:r,patch:a,connection:c}}("https://localhost:5001"),Game.Model=function(e){var t={apiUrl:e},n=function(){console.log(t.apiUrl)},o=function(e){return new Promise(function(n,o){Game.Data.get("".concat(t.apiUrl,"/api/Spel/Beurt/").concat(e)).then(function(e){if(0!==e&&1!==e&&2!==e)throw new Error("Incorrect state");n(e)})})},r=function(e){return new Promise(function(n,o){Game.Data.get("".concat(t.apiUrl,"/api/Spel/afgelopen/").concat(e)).then(function(e){n(e)})})};return{init:n,getGameState:o,getGame:function(e){return new Promise(function(n,o){Game.Data.get("".concat(t.apiUrl,"/api/Spel/").concat(e)).then(function(e){n(e)})})},getAfgelopen:r,updateScores:function(e){return new Promise(function(t,n){Game.Data.put("/Speler/Scores",e).then(function(e){t(e)})})}}}("https://localhost:5001"),Game.Template=function(){return{init:function(){},getTemplate:function(e){return spa_templates.templates.game["".concat(e)]},parseTemplate:function(e,t){return console.log(spa_templates.templates.game["".concat(e)]),spa_templates.templates.game["".concat(e)](t)}}}(),Game.API=function(){return{init:function(){},getFact:function(){return new Promise(function(e,t){Game.Data.get("https://asli-fun-fact-api.herokuapp.com/").then(function(t){e(t)})})}}}(),Game.Stats=function(){url;return{init:function(){}}},Game.init();