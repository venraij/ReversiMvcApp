"use strict";function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,o=function(){};return{s:o,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,c=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){i=!0,r=e},f:function(){try{c||null==n.return||n.return()}finally{if(i)throw r}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var FeedbackWidget=function(){function e(t){_classCallCheck(this,e),this._elementId=t}return _createClass(e,[{key:"elementId",get:function(){return this._elementId}},{key:"show",value:function(e,t){toggleFeedback(this.elementId,!0),$("#".concat(this.elementId,"-text")).text(e);var n=$("#".concat(this.elementId));n.alert(),"danger"===t?(n.removeClass("alert-success"),n.addClass("alert-danger")):(n.removeClass("alert-danger"),n.addClass("alert-success")),this.log({message:e,type:t})}},{key:"hide",value:function(){toggleFeedback(this.elementId,!1)}},{key:"log",value:function(e){var t=[],n=JSON.parse(localStorage.getItem("feedback_widget"));n&&(t=n),10===t.length&&t.splice(1,11),t.push(e),localStorage.setItem("feedback_widget",JSON.stringify(t))}},{key:"removeLog",value:function(){localStorage.removeItem("feedback_widget")}},{key:"history",value:function(){var e,t=JSON.parse(localStorage.getItem("feedback_widget")),n="",a=_createForOfIteratorHelper(t);try{for(a.s();!(e=a.n()).done;){var o=e.value;n+="".concat(o.type," - ").concat(o.message),t[-1]===o&&(n+=" \n")}}catch(e){a.e(e)}finally{a.f()}this.show(n)}}]),e}(),Game=function(e){var t={gameState:0,token:null,spel:null},n=function(){var e=window.location.search,n=new URLSearchParams(e),r=n.get("Guid");console.log("Speler Token:",r),t.token=r,Game.Model.init(),Game.Data.init("production"),Game.Template.init(),Game.API.init(),Game.Stats.init(),Game.Reversi.init(r),setInterval(a,2e3),o().then(function(){Game.Reversi.drawBord(r,t.spel.Bord),Game.Reversi.checkAfgelopen(r,t.spel)}),Game.Data.connection.start().catch(function(e){return console.error(e.toString())})},a=function(){Game.Model.getGameState(t.token).then(function(e){console.log("New Game State:",e),t.gameState=e})},o=function(){return new Promise(function(e,n){Game.Model.getGame(t.token).then(function(a){console.log("Game:",a),null===a.token?(n("Geen game gevonden"),window.location="/"):e(t.spel=a)})})};return{init:n,getCurrentGameState:a,getCurrentGame:o}}();Game.Reversi=function(){var e=function(e){t.token=e},t={token:null,cels:[]},n=function(e,n){var a,o=0,c=0,i=0,l=0,u=0,s=0,f=_createForOfIteratorHelper(n);try{for(f.s();!(a=f.n()).done;){var p,m=a.value,d=_createForOfIteratorHelper(m);try{for(d.s();!(p=d.n()).done;){var g=p.value,h=void 0;t.cels.length!==n.length*m.length&&(h={yValue:c,xValue:o,fiche:null},t.cels.push(h));var v=void 0;1===g?(v={kleur:"wit"},i+=1):2===g?(v={kleur:"zwart"},l+=1):s+=1;var y=t.cels.find(function(e){return e.yValue===c&&e.xValue===o}),w=y?y.fiche:null;w?(console.log("Replacing fiche at:","y".concat(c," x").concat(o)),console.log("Old fiche:",g.fiche),(1===g&&"zwart"===w.kleur||2===g&&"wit"===w.kleur)&&(y.fiche=v)):0!==g&&(console.log("Placing fiche at:","y".concat(c," x").concat(o)),y.fiche=v,u+=1),o++,8===o&&(o=0)}}catch(e){d.e(e)}finally{d.f()}c++}}catch(e){f.e(e)}finally{f.f()}Game.Stats.setStatsData(u,i,s,l);var k=$(".play-area");r(),k.empty(),k.append(Game.Template.parseTemplate("bord",{cells:t.cels})),Game.Stats.renderStats()},a=function(e,a){try{Game.Data.connection.invoke("Zet",parseInt(e),parseInt(a),t.token),Game.Data.connection.on("ZetDone",function(e,a,r){console.log("New Bord:",JSON.parse(r).Bord,a),"SUCCEEDED"===a&&(n(t.token,JSON.parse(r).Bord),o(t.token))})}catch(e){console.error(e)}},o=function(e){Game.Model.getAfgelopen(e).then(function(e){if("Niet afgelopen"!==e){console.log("Spel is afgelopen:",e);var t=$(".bord");t.empty();var n,a=0,o=0,r=_createForOfIteratorHelper(e.Bord);try{for(r.s();!(n=r.n()).done;){var c,i=n.value,l=_createForOfIteratorHelper(i);try{for(l.s();!(c=l.n()).done;){switch(c.value){case 1:a+=1;break;case 2:o+=1}}}catch(e){l.e(e)}finally{l.f()}}}catch(e){r.e(e)}finally{r.f()}var u,s;a>o?(u="wit",s=a):a===o?u="none":o>a&&(u="zwart",s=o);var f=document.createElement("ul");f.className="scores-list",t.append(f);var p=document.createElement("li");p.className="score",p.textContent="Wit: ".concat(a," punten"),f.append(p);var m=document.createElement("li");m.className="score",m.textContent="Zwart: ".concat(o," punten"),f.append(m);var d=document.createElement("li");d.className="winner-score",d.textContent="none"===u?"Gelijkspel!":"De winnaar is ".concat(u," met ").concat(s," punten!"),f.append(d);var g=document.createElement("li"),h=document.createElement("button");h.textContent="Exit Game",h.className="exit-button",h.onclick=function(){window.location="/"},g.append(h),f.append(g),Game.Model.updateScores(e)}})},r=function(){Game.API.getFact().then(function(e){console.log(e);var t=Game.Template.parseTemplate("fact",e.data);$(".play-area").prepend(t)})};return{init:e,doeZet:a,drawBord:n,checkAfgelopen:o}}(),Game.Data=function(e){var t={environment:"development"},n={mock:[{url:"api/Spel/Beurt",data:0},{url:"api/Spel"}],apiUrl:e},a=function(e){return"development"===t.environment?i(e):"production"===t.environment?fetch(e,{method:"GET"}).then(function(e){return e.json()}).catch(function(e){console.log(e)}):void 0},o=function(e,n,a){if("production"===t.environment)return fetch(e,{method:"PUT",headers:{"Content-Type":"application/json",spelToken:a},body:JSON.stringify(n)}).then(function(e){return e.json()}).catch(function(e){console.log(e)})},r=function(e,n,a){if("production"===t.environment)return fetch(e,{method:"PATCH",headers:{"Content-Type":"application/json",spelToken:a},body:JSON.stringify(n)}).then(function(e){return e.json()}).catch(function(e){console.log(e)})},c=(new signalR.HubConnectionBuilder).withUrl("https://localhost:5001/gameHub").configureLogging(signalR.LogLevel.Information).build(),i=function(e){var t=n.mock.find(function(t){return t.url===e});return new Promise(function(e,n){e(t)})};return{init:function(e){if(console.log(n.apiUrl),t.environment=e,"production"!==t.environment&&"development"!==t.environment)throw new Error("Environment not set in state or set incorrectly")},get:a,put:o,patch:r,connection:c}}("https://localhost:5001"),Game.Model=function(e){var t={apiUrl:e},n=function(){console.log(t.apiUrl)},a=function(e){return new Promise(function(n,a){Game.Data.get("".concat(t.apiUrl,"/api/Spel/Beurt/").concat(e)).then(function(e){if(0!==e&&1!==e&&2!==e)throw new Error("Incorrect state");n(e)})})},o=function(e){return new Promise(function(n,a){Game.Data.get("".concat(t.apiUrl,"/api/Spel/afgelopen/").concat(e)).then(function(e){n(e)})})};return{init:n,getGameState:a,getGame:function(e){return new Promise(function(n,a){Game.Data.get("".concat(t.apiUrl,"/api/Spel/").concat(e)).then(function(e){n(e)})})},getAfgelopen:o,updateScores:function(e){return new Promise(function(t,n){Game.Data.put("/Speler/Scores",e).then(function(e){t(e)})})}}}("https://localhost:5001"),Game.Template=function(){return{init:function(){},getTemplate:function(e){return spa_templates.templates.game["".concat(e)]},parseTemplate:function(e,t){return console.log(spa_templates.templates.game["".concat(e)]),spa_templates.templates.game["".concat(e)](t)}}}(),Game.API=function(){return{init:function(){},getFact:function(){return new Promise(function(e,t){Game.Data.get("https://asli-fun-fact-api.herokuapp.com/").then(function(t){e(t)})})}}}(),Game.Stats=function(){var e=function(){},t={celsOccupied:0,celsUnoccupied:0,whiteFiches:0,blackFiches:0},n=function(e,n,a,o){t.celsOccupied=e,t.celsUnoccupied=a,t.whiteFiches=n,t.blackFiches=o};return{init:e,renderStats:function(){$(".play-area").append(Game.Template.parseTemplate("stats",t))},setStatsData:n}}(),Game.init();